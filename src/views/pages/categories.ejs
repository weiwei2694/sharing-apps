<section class="d-flex flex-column">
  <div class="d-flex justify-content-between align-items-end">
    <h1 class="detailPost__heading">Categories</h1>
    <a href="/post/create" class="btn btn-primary">Create Category</a>
  </div>
  <table class="table">
    <thead>
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Total Post</th>
        <th scope="col">Handle</th>
      </tr>
    </thead>
    <tbody>
      <% if (typeof categories !=='undefined' ) { %>
        <% categories.forEach(function(category) { %>
          <tr>
            <th scope="row">
              <%= category.name %>
            </th>
            <td>
              <%= category.posts.length %>
            </td>
            <td class="d-flex align-items-center gap-2">
              <button class="btn btn-danger" data-categoryid="<%= category.id %>" id="myBtn">
                <i class="fa-solid fa-trash"></i>
              </button>
              <a class="btn btn-success" href="/?category=<%= category.name %>" target="_blank">
                <i class="fa-solid fa-magnifying-glass"></i>
              </a>
            </td>
          </tr>
          <% }) %>
            <% } %>
    </tbody>
  </table>
</section>

<!-- The Modal -->
<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close" style="display: none;">&times;</span>
    <h3 class="detailPost__modal-heading">Delete Category?</h3>
    <p class="detailPost__modal-paragraph">This action can't be undone and will remove the category from your profile,
      the timeline of any posts in this category, and from search results.</p>
    <div class="d-flex flex-column">
      <form method="post" id="delete-category-form">
        <button type="submit" class="detailPost__modal-button detailPost__modal-button__delete">Delete</button>
      </form>
      <button class="detailPost__modal-button detailPost__modal-button__cancel" onclick="cancelDelete()">Cancel</button>
    </div>
  </div>
</div>

<script>
  const modal = document.getElementById("myModal"),
    formDeleteCategory = document.getElementById('delete-category-form'),
    btns = document.querySelectorAll("#myBtn"),
    span = document.getElementsByClassName("close")[0];

  btns.forEach(function (btn) {
    btn.onclick = function () {
      const categoryId = this.dataset.categoryid
      modal.style.display = "block";

      formDeleteCategory.action = `/category/${categoryId}?_method=DELETE`
    }
  })

  function cancelDelete() {
    modal.style.display = "none";
  }

  function myFunction() {
    document.getElementById("myDropdown").classList.toggle("show");
  }

  window.onclick = function (event) {
    if (event.target === modal) {
      modal.style.display = "none";
    }
  }
</script>
